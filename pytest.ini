[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
python_classes = Test*

markers =
    live: mark test as requiring live services (PostgreSQL, APIs, etc.)
    ui: mark test as requiring browser/UI (Playwright)
    e2e: mark test as end-to-end workflow test
    slow: mark test as slow running
    smoke: mark test as smoke test for deployment verification (fast, < 30s)
    dashboard: mark test as dashboard-specific test
    playwright: mark test as requiring Playwright browser automation

addopts =
    -v
    --tb=short
    --cov=insights_core
    --cov=agents
    --cov=ingestors
    --cov=insights_api
    --cov=scheduler
    --cov=mcp
    --cov=metrics_exporter
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-fail-under=90

# Default: skip UI and live tests (for fast local development)
# For live tests: pytest -m live
# For UI tests: pytest -m ui
# For E2E tests: pytest -m e2e
# For dashboard tests: pytest -m dashboard
# For Playwright tests: pytest -m playwright
# For all tests: pytest -m ""

# Async mode for pytest-asyncio
asyncio_mode = auto

# Timeout for individual tests (in seconds)
timeout = 300

# Playwright configuration
# Browser options: chromium, firefox, webkit
# Use BROWSER_TYPE env var to override
# Use HEADLESS=false for headed mode

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "#3274D9",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "templating": {
    "list": [
      {
        "name": "subdomain",
        "label": "Subdomain",
        "type": "query",
        "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
        "definition": "SELECT DISTINCT split_part(regexp_replace(url, '^https?://', ''), '/', 1) FROM gsc.fact_gsc_daily WHERE url IS NOT NULL ORDER BY 1",
        "query": "SELECT DISTINCT split_part(regexp_replace(url, '^https?://', ''), '/', 1) FROM gsc.fact_gsc_daily WHERE url IS NOT NULL ORDER BY 1",
        "refresh": 1,
        "sort": 1,
        "includeAll": true,
        "allValue": "'ALL'",
        "current": {"text": "All", "value": "$__all"},
        "options": [],
        "multi": false
      }
    ]
  },
  "description": "Google Search Console data overview - clicks, impressions, CTR, position tracking and top performing content",
  "title": "GSC Data - Overview",
  "uid": "gsc-overview",
  "version": 3,
  "timezone": "browser",
  "schemaVersion": 38,
  "refresh": "5m",
  "time": {
    "from": "now-90d",
    "to": "now"
  },
  "tags": ["gsc", "search-console", "seo", "analytics"],
  "links": [
    {"asDropdown": true, "icon": "external link", "includeVars": true, "keepTime": true, "tags": ["analytics"], "targetBlank": true, "title": "Analytics Dashboards", "type": "dashboards"},
    {"icon": "dashboard", "title": "GA4 Overview", "type": "link", "url": "/d/ga4-overview", "targetBlank": true},
    {"icon": "dashboard", "title": "Hybrid View", "type": "link", "url": "/d/hybrid-overview", "targetBlank": true}
  ],
  "panels": [
    {"id": 100, "title": "Key Metrics (30 Days)", "type": "row", "gridPos": {"h": 1, "w": 24, "x": 0, "y": -1}, "collapsed": false},
      {
        "id": 1,
        "title": "Total Clicks (Last 30 Days)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT SUM(clicks)::bigint as \"Total Clicks\" FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain})",
          "refId": "A"
        }],
        "options": {
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          },
          "colorMode": "value",
          "graphMode": "area",
          "orientation": "auto"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "#73BF69", "value": null},
                {"color": "#FADE2A", "value": 10000},
                {"color": "#F2495C", "value": 100000}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "title": "Total Impressions (Last 30 Days)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT SUM(impressions)::bigint as \"Total Impressions\" FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain})",
          "refId": "A"
        }],
        "options": {
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          },
          "colorMode": "value",
          "graphMode": "area"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "#3274D9", "value": null}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "title": "Average CTR (Last 30 Days)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT ROUND(AVG(ctr)::numeric, 4) as \"CTR\" FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND ctr > 0 AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain})",
          "refId": "A"
        }],
        "options": {
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          },
          "colorMode": "value",
          "graphMode": "area"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "#F2495C", "value": null},
                {"color": "#FADE2A", "value": 0.02},
                {"color": "#73BF69", "value": 0.05}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Average Position (Last 30 Days)",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 0},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT ROUND(AVG(position)::numeric, 1) as \"Position\" FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND position > 0 AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain})",
          "refId": "A"
        }],
        "options": {
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"]
          },
          "colorMode": "value",
          "graphMode": "area"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "#73BF69", "value": null},
                {"color": "#FADE2A", "value": 10},
                {"color": "#F2495C", "value": 20}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Clicks Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 4},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "time_series",
          "rawSql": "SELECT date AS time, SUM(clicks) AS value FROM gsc.fact_gsc_daily WHERE $__timeFilter(date) AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain}) GROUP BY date ORDER BY date",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 10,
              "pointSize": 5,
              "showPoints": "never"
            },
            "color": {"mode": "palette-classic"}
          }
        }
      },
      {
        "id": 6,
        "title": "Top Performing Pages (Last 30 Days)",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT url as full_url, SUM(clicks) as clicks, SUM(impressions) as impressions, ROUND((SUM(clicks)::numeric / NULLIF(SUM(impressions), 0)), 4) as ctr, ROUND(AVG(position)::numeric, 1) as avg_position FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND clicks > 0 AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain}) GROUP BY url ORDER BY clicks DESC LIMIT 50",
          "refId": "A"
        }],
        "options": {
          "showHeader": true,
          "sortBy": [{"displayName": "clicks", "desc": true}]
        },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "align": "auto",
              "displayMode": "auto"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "clicks"},
              "properties": [{"id": "custom.displayMode", "value": "color-background"}]
            },
            {
              "matcher": {"id": "byName", "options": "impressions"},
              "properties": [{"id": "custom.displayMode", "value": "color-background"}]
            },
            {
              "matcher": {"id": "byName", "options": "ctr"},
              "properties": [
                {"id": "unit", "value": "percentunit"},
                {"id": "custom.displayMode", "value": "color-background"}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "avg_position"},
              "properties": [{"id": "decimals", "value": 1}]
            }
          ]
        }
      },
      {
        "id": 10,
        "title": "Top Queries (Last 30 Days)",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT query, SUM(clicks) as clicks, SUM(impressions) as impressions, ROUND((SUM(clicks)::numeric / NULLIF(SUM(impressions), 0)), 4) as ctr, ROUND(AVG(position)::numeric, 1) as avg_position FROM gsc.fact_gsc_daily WHERE date >= CURRENT_DATE - INTERVAL '30 days' AND query IS NOT NULL AND query != '' AND clicks > 0 AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain}) GROUP BY query ORDER BY clicks DESC LIMIT 50",
          "refId": "A"
        }],
        "options": {
          "showHeader": true,
          "sortBy": [{"displayName": "clicks", "desc": true}]
        },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "align": "auto",
              "displayMode": "auto"
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "clicks"},
              "properties": [{"id": "custom.displayMode", "value": "color-background"}]
            },
            {
              "matcher": {"id": "byName", "options": "impressions"},
              "properties": [{"id": "custom.displayMode", "value": "color-background"}]
            },
            {
              "matcher": {"id": "byName", "options": "ctr"},
              "properties": [
                {"id": "unit", "value": "percentunit"},
                {"id": "custom.displayMode", "value": "color-background"}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "avg_position"},
              "properties": [{"id": "decimals", "value": 1}]
            }
          ]
        }
      },
      {
        "id": 7,
        "title": "Recent Insights (Last 10)",
        "type": "table",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 20},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "table",
          "rawSql": "SELECT split_part(regexp_replace(property, '^https?://', ''), '/', 1) as hostname, entity_id as page, category, severity, title, description, generated_at FROM gsc.insights ORDER BY generated_at DESC LIMIT 10",
          "refId": "A"
        }],
        "options": {
          "showHeader": true
        }
      },
      {
        "id": 8,
        "title": "Impressions Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "time_series",
          "rawSql": "SELECT date AS time, SUM(impressions) AS value FROM gsc.fact_gsc_daily WHERE $__timeFilter(date) AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain}) GROUP BY date ORDER BY date",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 10
            },
            "color": {"mode": "palette-classic"}
          }
        }
      },
      {
        "id": 9,
        "title": "CTR Trend",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
        "targets": [{
          "datasource": {"type": "grafana-postgresql-datasource", "uid": "postgres-gsc"},
          "format": "time_series",
          "rawSql": "SELECT date AS time, AVG(ctr) AS value FROM gsc.fact_gsc_daily WHERE $__timeFilter(date) AND ctr > 0 AND (UPPER(${subdomain}) = 'ALL' OR split_part(regexp_replace(url, '^https?://', ''), '/', 1) = ${subdomain}) GROUP BY date ORDER BY date",
          "refId": "A"
        }],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "fillOpacity": 20
            },
            "color": {"mode": "palette-classic"}
          }
        }
      }
    ]
}

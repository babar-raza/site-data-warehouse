GSC Data Warehouse - Complete Project Structure
================================================

gsc-warehouse/
│
├── PROJECT_SUMMARY.md                    # Comprehensive reorganization summary
├── README.md                             # Project overview and quick start
├── .env.example                          # Configuration template
├── docker-compose.yml                    # Unified service orchestration (NEW)
│
├── deploy.sh                             # Linux/Mac deployment script (NEW)
├── deploy.bat                            # Windows deployment script (NEW)
├── redeploy.sh                           # Update/redeploy script (NEW)
│
├── deployment/                           # All deployment artifacts (ORGANIZED)
│   ├── compose/                          # Individual service compose files
│   │   ├── api_ingestor.yml
│   │   ├── insights_api.yml
│   │   ├── mcp.yml
│   │   └── warehouse.yml
│   │
│   ├── dockerfiles/                      # All Dockerfiles
│   │   ├── Dockerfile.insights_api
│   │   ├── Dockerfile.mcp
│   │   ├── Dockerfile.metrics
│   │   ├── Dockerfile.scheduler
│   │   └── Dockerfile.transformer
│   │
│   ├── init-db/                          # Database initialization scripts
│   │   ├── 00_init.sh
│   │   └── 01_schema.sql
│   │
│   ├── prometheus/                       # Prometheus configuration
│   │   └── prometheus.yml
│   │
│   ├── scripts/                          # Helper scripts
│   │   ├── health-check.sh
│   │   ├── health-check.bat
│   │   ├── start-collection.sh
│   │   ├── start-collection.bat
│   │   ├── stop.sh
│   │   ├── stop.bat
│   │   ├── validate-setup.sh
│   │   └── validate-setup.bat
│   │
│   └── docs/                             # Deployment documentation
│       ├── API_REFERENCE.md
│       ├── ARCHITECTURE.md
│       ├── DEPLOYMENT.md
│       ├── DEVELOPMENT.md
│       ├── IMPROVEMENTS.md
│       ├── RATE_LIMITING.md
│       └── WINDOWS_QUICKSTART.md
│
├── cookbooks/                            # Operational guides (NEW)
│   ├── deployment-cookbook.md            # Complete deployment guide
│   ├── gsc-data-collection-cookbook.md   # Data collection operations
│   └── operations-cookbook.md            # Day-to-day operations
│
├── ingestors/                            # Data ingestion logic
│   └── api/
│       ├── __init__.py
│       ├── api_ingestor.py               # Entry point
│       ├── gsc_api_ingestor.py           # GSC API fetcher
│       └── rate_limiter.py               # Enterprise rate limiter
│
├── scheduler/                            # Scheduling and orchestration
│   ├── scheduler.py                      # Daily/weekly scheduler
│   ├── startup_orchestrator.py           # Automatic data collection (NEW)
│   └── metrics_exporter.py               # Prometheus metrics
│
├── transform/                            # SQL transformations (NEW)
│   └── apply_transforms.py               # View creation script
│
├── insights_api/                         # REST API service
│   └── insights_api.py
│
├── mcp/                                  # MCP server (AI integration)
│   └── mcp_server.py
│
├── sql/                                  # SQL scripts
│   ├── 01_schema.sql                     # Database schema
│   ├── 02_upsert_template.sql           # Upsert procedure
│   └── 03_transforms.sql                 # Analytical views
│
├── secrets/                              # Credentials (user provided)
│   ├── README.md
│   ├── gsc_sa.json.template             # Service account template
│   ├── gsc_sa.json                       # Google Cloud credentials
│   └── db_password.txt                   # Database password
│
├── tests/                                # Test suite
│   ├── __init__.py
│   ├── conftest.py
│   ├── test_api_ingestor.py
│   ├── test_bootstrap.py
│   ├── test_insights_api.py
│   ├── test_mcp_server.py
│   ├── test_ollama.py
│   └── test_rate_limiter.py
│
├── logs/                                 # Runtime logs (created)
│   ├── scheduler.log
│   ├── startup_orchestrator.log
│   └── scheduler_metrics.json
│
└── report/                               # Status reports (created)
    ├── startup/
    │   └── orchestrator_status.json
    └── phase-3/
        ├── status.json
        └── watermarks_after.json

Key Changes Summary
===================

NEW FILES:
----------
✓ docker-compose.yml - Unified orchestration
✓ scheduler/startup_orchestrator.py - Automatic data collection
✓ transform/apply_transforms.py - SQL view application
✓ deploy.sh / deploy.bat - Deployment scripts
✓ redeploy.sh - Redeployment script
✓ .env.example - Configuration template
✓ cookbooks/ - Three operational guides

REORGANIZED:
-----------
✓ deployment/ - All deployment artifacts
  - compose/
  - dockerfiles/
  - init-db/
  - prometheus/
  - scripts/
  - docs/

ENHANCED:
--------
✓ Automatic data collection on deployment
✓ Health checks and service dependencies
✓ Comprehensive error handling and reporting
✓ Clear operational documentation

Service Architecture
====================

Core Services (Always Running):
-------------------------------
warehouse         - PostgreSQL database
mcp               - MCP server for AI integration

Automatic on Deploy:
--------------------
startup_orchestrator - One-time initial data collection

Scheduled Services:
------------------
scheduler         - Daily (2 AM UTC) and weekly tasks

On-Demand (Profiles):
--------------------
api_ingestor      - Manual data collection (profile: ingestion)
transformer       - Manual view creation (profile: transform)
insights_api      - REST API (profile: api)
metrics_exporter  - Prometheus metrics (profile: observability)
prometheus        - Metrics dashboard (profile: observability)

Data Flow
=========

Deployment → startup_orchestrator → API Ingestion → Database → Transforms → Views

Daily (2 AM UTC) → scheduler → API Ingestion → Database → Transforms → Views

Manual → docker compose run api_ingestor → Database

Quick Start
===========

1. Setup credentials:
   cp secrets/gsc_sa.json.template secrets/gsc_sa.json
   # Edit with your Google Cloud service account

2. Deploy:
   ./deploy.sh              # Linux/Mac
   deploy.bat               # Windows

3. Verify:
   docker compose ps
   docker compose exec warehouse psql -U gsc_user -d gsc_db \
     -c "SELECT COUNT(*) FROM gsc.fact_gsc_daily;"

4. Monitor:
   docker compose logs -f

Operational Commands
====================

Health Check:
  docker compose ps
  ./deployment/scripts/health-check.sh

View Logs:
  docker compose logs -f
  docker compose logs -f scheduler

Manual Data Collection:
  docker compose run --rm api_ingestor
  docker compose run --rm startup_orchestrator

Redeploy:
  ./redeploy.sh

Stop:
  docker compose down

Start Additional Services:
  docker compose --profile api up -d insights_api
  docker compose --profile observability up -d metrics_exporter prometheus

For More Information
====================

See:
- PROJECT_SUMMARY.md - Complete reorganization details
- cookbooks/deployment-cookbook.md - Deployment guide
- cookbooks/gsc-data-collection-cookbook.md - Data collection details
- cookbooks/operations-cookbook.md - Day-to-day operations
